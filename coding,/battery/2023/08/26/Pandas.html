<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta name="google-site-verification" content="0jJEiwveRaLt5uF9gnti0E2wVHK4kuWW9umLobdkcm0"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>Using the Pandas library to process battery cycling data. | Roby Gauthier, Ph.D.</title> <meta name="author" content="Roby Gauthier"> <meta name="description" content="A simple, whitespace theme for academics. Based on [*folio](https://github.com/bogoli/-folio) design. "> <meta name="keywords" content="electrochemistry, roby-gauthier, carnegie-mellon, carnegie-mellon-mechanical, battery, lithium-ion-batteries, casimir-effect, fuel-cells, jeff-dahn, venkat-viswanathan, jay-whitacre, shawn-lister"> <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha256-DF7Zhf293AJxJNTmh5zhoYYIMs2oXitRfBjY+9L//AY=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.1/css/academicons.min.css" integrity="sha256-i1+4qU2G2860dGGIOJscdC30s9beBXjFfzjWLjBRsBg=" crossorigin="anonymous"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/github.css" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%E2%9A%9B%EF%B8%8F&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css"> <link rel="canonical" href="https://robygauthier.github.io/coding,/battery/2023/08/26/Pandas.html"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/native.css" media="none" id="highlight_theme_dark"> <script src="/assets/js/theme.js"></script> <script src="/assets/js/dark_mode.js"></script> <script async src="https://www.googletagmanager.com/gtag/js?id=G-6TX3WKLFPD"></script> <script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-6TX3WKLFPD");</script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/">Roby Gauthier, Ph.D.</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">About</a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">Publications</a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">CV</a> </li> <li class="nav-item dropdown "> <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">More</a> <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown"> <a class="dropdown-item" href="/theses/">Master and Doctoral Theses</a> <div class="dropdown-divider"></div> <a class="dropdown-item" href="/teaching/">Teaching</a> </div> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fas fa-moon"></i> <i class="fas fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5"> <div class="post"> <header class="post-header"> <h1 class="post-title">Using the Pandas library to process battery cycling data.</h1> <p class="post-meta">August 26, 2023</p> <p class="post-tags"> <a href="/blog/2023"> <i class="fas fa-calendar fa-sm"></i> 2023 </a>   ·   <a href="/blog/tag/coding"> <i class="fas fa-hashtag fa-sm"></i> coding,</a>   <a href="/blog/tag/battery"> <i class="fas fa-hashtag fa-sm"></i> battery</a>     ·   <a href="/blog/category/coding"> <i class="fas fa-tag fa-sm"></i> coding,</a>   <a href="/blog/category/battery"> <i class="fas fa-tag fa-sm"></i> battery</a>   </p> </header> <article class="post-content"> <p>Today we going to see how to use the python library Pandas on some battery cycling data. Pandas is useful to process Excel files efficiently. Here we will calculate delta V values of a cell versus cycle number from the voltage versus time data. delta V is closely related to the resistance of the cell.</p> <p>Let’s start by importing the Pandas library:</p> <figure class="highlight"><pre><code class="language-python" data-lang="python"> 
<span class="kn">import</span> <span class="n">pandas</span> <span class="k">as</span> <span class="n">pd</span></code></pre></figure> <p>Now we are ready to import the data. Here we will import the third sheet from a .xls of a cell with a Cell ID of 87. The output df is a Pandas dataframe.</p> <figure class="highlight"><pre><code class="language-python" data-lang="python"> 
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">read_excel</span><span class="p">(</span><span class="sh">'</span><span class="s">CellID87.xls</span><span class="sh">'</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span></code></pre></figure> <p>Now is type to start preprocessing. The data in question is cycling data from a Neware cycler. Let’s first remove the part of the data that correspond to when the cell is in status ‘rest’, which mean the cell is not charging or discharging, but just resting, as this data is not needed for the calculation of delta V. Below we are essentially saying: take the row of the dataframe were values from column ‘Status’ are not equal to ‘Rest’.</p> <figure class="highlight"><pre><code class="language-python" data-lang="python"> 
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">Status</span><span class="sh">'</span><span class="p">]</span> <span class="o">!=</span> <span class="sh">'</span><span class="s">Rest</span><span class="sh">'</span><span class="p">]</span></code></pre></figure> <p>On the block of code, we first take the row of the dataframe were values from column ‘Status’ are equal to ‘CC_DChg’ for the discharge curves (df_disch) and equal to ‘CCCV_Chg’ for the charge curves (df_charg). Then, for the discharge curves, and similarly for the charge curves, we group all values that have all the same step values and take the average. However, we are here only interested in the average of the voltage for each steps as well as the cycle numbers.</p> <figure class="highlight"><pre><code class="language-python" data-lang="python"> 
<span class="n">df_disch</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">Status</span><span class="sh">'</span><span class="p">]</span><span class="o">==</span><span class="sh">'</span><span class="s">CC_DChg</span><span class="sh">'</span><span class="p">].</span><span class="nf">groupby</span><span class="p">(</span><span class="sh">'</span><span class="s">Step</span><span class="sh">'</span><span class="p">).</span><span class="nf">mean</span><span class="p">(</span><span class="n">numeric_only</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">df_charg</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">Status</span><span class="sh">'</span><span class="p">]</span><span class="o">==</span><span class="sh">'</span><span class="s">CCCV_Chg</span><span class="sh">'</span><span class="p">].</span><span class="nf">groupby</span><span class="p">(</span><span class="sh">'</span><span class="s">Step</span><span class="sh">'</span><span class="p">).</span><span class="nf">mean</span><span class="p">(</span><span class="n">numeric_only</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span></code></pre></figure> <p>We then merge both dataframe df_disch and df_charg into a single dataframe df0. We do this merging such that the cycle number value are the same for both for a single row in df0.</p> <figure class="highlight"><pre><code class="language-python" data-lang="python"> 
<span class="n">df0</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">merge</span><span class="p">(</span><span class="n">df_disch</span><span class="p">,</span> <span class="n">df_charg</span><span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="sh">'</span><span class="s">Cycle</span><span class="sh">'</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="sh">'</span><span class="s">outer</span><span class="sh">'</span><span class="p">)</span></code></pre></figure> <p>We then substract the value of average voltage for charge steps from the average voltage for discharge steps.</p> <figure class="highlight"><pre><code class="language-python" data-lang="python"> 
<span class="n">df0</span><span class="p">[</span><span class="sh">'</span><span class="s">delta_V</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df0</span><span class="p">[</span><span class="sh">'</span><span class="s">Voltage(V)_y</span><span class="sh">'</span><span class="p">]</span> <span class="o">-</span> <span class="n">df0</span><span class="p">[</span><span class="sh">'</span><span class="s">Voltage(V)_x</span><span class="sh">'</span><span class="p">]</span></code></pre></figure> <p>We then reorganise the data so that it can be plotted as delta V versus cycle number.</p> <figure class="highlight"><pre><code class="language-python" data-lang="python"> 
<span class="n">df01</span> <span class="o">=</span> <span class="n">df0</span><span class="p">.</span><span class="nf">set_index</span><span class="p">(</span><span class="sh">'</span><span class="s">Cycle</span><span class="sh">'</span><span class="p">)</span>
<span class="n">df2</span> <span class="o">=</span> <span class="n">df01</span><span class="p">[</span><span class="sh">'</span><span class="s">delta_V</span><span class="sh">'</span><span class="p">].</span><span class="nf">to_frame</span><span class="p">().</span><span class="nf">reset_index</span><span class="p">()</span>
<span class="n">df2</span><span class="p">.</span><span class="nf">plot</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="sh">'</span><span class="s">Cycle</span><span class="sh">'</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="sh">'</span><span class="s">delta_V</span><span class="sh">'</span><span class="p">,</span><span class="n">kind</span><span class="o">=</span><span class="sh">'</span><span class="s">scatter</span><span class="sh">'</span><span class="p">,</span><span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.2</span><span class="p">))</span></code></pre></figure> <p>The result is the following graph:</p> <div class="mt-3"> <figure> <picture> <img src="/assets/img/deltaV.png" class="img-fluid rounded z-depth-2" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <div class="caption"> Graph of delta V as function of cycle number. </div> </div> </article> </div> </div> <footer class="fixed-bottom"> <div class="container mt-0"> © Copyright 2025 Roby Gauthier. Last updated: January 28, 2025. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js" integrity="sha256-fgLAgv7fyCGopR/gBNq2iW3ZKIdqIcyshnUULC4vex8=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.8/dist/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js"></script> <script defer src="/assets/js/common.js"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script async src="https://www.googletagmanager.com/gtag/js?id=G-6TX3WKLFPD"></script> <script>function gtag(){window.dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-6TX3WKLFPD");</script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>